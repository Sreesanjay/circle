import{r as c,m as $,i as L,Q as C,j as e,a as I,u as N,aj as B,P as D,aQ as J,T as ee,aR as se,aS as te,Y as re,Z as ie,ai as ae,aT as ne,aU as le,aV as ce,aW as oe,aX as de,s as ue,aY as H,aZ as me,ae as xe,aK as fe,ac as he,A as ge,a_ as je}from"./index-AlnpICX-.js";import{H as pe}from"./HomeSidebar-QKTQcj5C.js";import{d as ve}from"./index.esm-FIJ0PoMy.js";import{L as we,a as A,b as P,c as O,P as ye}from"./PostModal-vqLSgkE2.js";import{R as Ne}from"./Report-Nz4q8LAH.js";import{M as T}from"./Toast-gwQzg9lN.js";import{u as be,S as _e,a as E}from"./Skeleton-Uoqy6pAX.js";import{m as Se}from"./chatService-b-lgsd3Y.js";import"./index.esm-NDHy72TF.js";import"./Menu-5GrriLQx.js";import"./index.esm-igZWupnF.js";import"./index.esm-gSoOfemA.js";import"./index.esm-FNC61qCj.js";import"./usehandleError-r6L22Xgg.js";import"./Badge-Yepby1Wp.js";import"./Typography-F8UBnkHW.js";import"./extendSxProp-FE39Tchg.js";import"./createBox-ycqju-4S.js";var V=new Map,R=new WeakMap,W=0,Ce=void 0;function ke(s){return s?(R.has(s)||(W+=1,R.set(s,W.toString())),R.get(s)):"0"}function Ee(s){return Object.keys(s).sort().filter(n=>s[n]!==void 0).map(n=>`${n}_${n==="root"?ke(s.root):s[n]}`).toString()}function Re(s){let n=Ee(s),a=V.get(n);if(!a){const o=new Map;let u;const t=new IntersectionObserver(l=>{l.forEach(r=>{var i;const d=r.isIntersecting&&u.some(m=>r.intersectionRatio>=m);s.trackVisibility&&typeof r.isVisible>"u"&&(r.isVisible=d),(i=o.get(r.target))==null||i.forEach(m=>{m(d,r)})})},s);u=t.thresholds||(Array.isArray(s.threshold)?s.threshold:[s.threshold||0]),a={id:n,observer:t,elements:o},V.set(n,a)}return a}function Le(s,n,a={},o=Ce){if(typeof window.IntersectionObserver>"u"&&o!==void 0){const i=s.getBoundingClientRect();return n(o,{isIntersecting:o,target:s,intersectionRatio:typeof a.threshold=="number"?a.threshold:0,time:0,boundingClientRect:i,intersectionRect:i,rootBounds:i}),()=>{}}const{id:u,observer:t,elements:l}=Re(a);let r=l.get(s)||[];return l.has(s)||l.set(s,r),r.push(n),t.observe(s),function(){r.splice(r.indexOf(n),1),r.length===0&&(l.delete(s),t.unobserve(s)),l.size===0&&(t.disconnect(),V.delete(u))}}function Ie({threshold:s,delay:n,trackVisibility:a,rootMargin:o,root:u,triggerOnce:t,skip:l,initialInView:r,fallbackInView:i,onChange:d}={}){var m;const[f,x]=c.useState(null),j=c.useRef(),[h,w]=c.useState({inView:!!r,entry:void 0});j.current=d,c.useEffect(()=>{if(l||!f)return;let v;return v=Le(f,(b,_)=>{w({inView:b,entry:_}),j.current&&j.current(b,_),_.isIntersecting&&t&&v&&(v(),v=void 0)},{root:u,rootMargin:o,threshold:s,trackVisibility:a,delay:n},i),()=>{v&&v()}},[Array.isArray(s)?s.toString():s,f,u,o,t,l,a,i,n]);const y=(m=h.entry)==null?void 0:m.target,k=c.useRef();!f&&y&&!t&&!l&&k.current!==y&&(k.current=y,w({inView:!!r,entry:void 0}));const p=[x,h.inView,h.entry];return p.ref=p[0],p.inView=p[1],p.entry=p[2],p}function Me({openModal:s,setOpenModal:n,post_id:a}){const[o,u]=c.useState([]),t=$(),l=c.useRef(!1),[r,i]=c.useState(!1),d=c.useRef(0),m=be(()=>f("")),f=c.useCallback(async x=>{i(!0);const j=`/posts/liked-user-list/${a}?search=${x}&page=${d.current}`;try{const h=await L.get(j,{withCredentials:!0});h.data&&(d.current=d.current+1,l.current?(l.current=!1,u(h.data.userList)):u(w=>[...w,...h.data.userList])),i(!1)}catch(h){const w=h;C.error(w.message),i(!1)}},[a]);return c.useEffect(()=>{s&&(d.current=0,f(""))},[s,f]),e.jsxs(T,{show:s,size:"md",onClose:()=>{u([]),n(!1)},children:[e.jsx(T.Header,{children:e.jsx("div",{className:"space-y-6 text-center mb-3",children:"Likes"})}),e.jsx("div",{className:"h-96 overflow-y-scroll userList",ref:m,children:e.jsxs(T.Body,{children:[e.jsxs("div",{className:"users-list",children:[e.jsx("input",{type:"text",className:"rounded-md w-full",onChange:x=>{l.current=!0,d.current=0,f(x.target.value)}}),o&&o.map((x,j)=>e.jsx("div",{className:"user-card my-4 bg-gray-100 p-2 rounded-md flex items-center gap-3 justify-between",onClick:()=>t(`/view-profile/${x.user_id}`),children:e.jsxs("div",{className:"left flex gap-3",onClick:()=>t(`/view-profile/${x.user_id}`),children:[x.profile_img?e.jsx("img",{src:x.profile_img,alt:"",className:"w-10 rounded-md"}):e.jsx("h1",{className:"p-2 px-4 rounded-md bg-gray-400",children:x.email[0].toUpperCase()}),e.jsxs("div",{className:"name",children:[e.jsx("h1",{children:x.username}),e.jsx("p",{className:"text-sm text-gray-600",children:x.fullname})]})]})},j))]}),r&&e.jsx(_e,{})]})})]})}function Ae({post:s}){var z;const n=I(),a=$(),{isError:o,isSuccess:u}=N(g=>g.post),{user:t}=N(g=>g.auth),[l,r]=c.useState(!1),[i,d]=c.useState(!0),m=c.useRef(null),[f,x]=c.useState(!1),[j,h]=c.useState(!1),[w,y]=c.useState(!1),[k,p]=c.useState(!1),{ref:v,inView:b}=Ie({threshold:1});c.useEffect(()=>{var g,S;b?(d(!0),(g=m.current)==null||g.play()):(d(!0),(S=m.current)==null||S.pause())},[b,v]);const _=()=>{const g=m.current;g&&(i?g.muted=!1:g.muted=!0,d(!i))};function Y(){n(ne(s._id))}function G(){n(le(s._id))}function Q(){n(ce(s._id))}function Z(){n(oe(s._id))}function K(){y(!0)}c.useEffect(()=>{n(B())},[u,o,n]);async function X(){var S,U;if(await de(s._id)&&s.user_details){const F=s.user_id;if(((S=s.is_boosted)==null?void 0:S.action)==="PROFILE_VISIT")a(`/view-profile/${F}`);else if(((U=s.is_boosted)==null?void 0:U.action)==="MESSAGE"){const q=await Se(F);n(ue(q.chat)),a("/messages")}}}const M=new Date(s==null?void 0:s.createdAt);return e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"post-card lg:w-6/6 mb-5 bg-gray-900 rounded-md shadow-lg pb-3",children:[e.jsxs("div",{className:"header flex gap-3 px-5 py-2 shadow-sm justify-between relative",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"profile-img-icon",children:s!=null&&s.user_details.profile_img?e.jsx("img",{src:(z=s==null?void 0:s.user_details)==null?void 0:z.profile_img,alt:"",style:{},className:"w-12 rounded-lg"}):e.jsx(D,{email:(s==null?void 0:s.user_details.email.email)||"",size:"medium"})}),e.jsxs("div",{className:"name",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("h1",{children:s.user_details.username}),e.jsx("p",{children:s.user_details.verified&&e.jsx("p",{className:"text-blue-600 text-xl",children:e.jsx(J,{})})})]}),e.jsx("small",{className:"text-xs text-slate-500",children:`${M.getDay()} - ${M.getMonth()+1} - ${M.getFullYear()}`})]})]}),e.jsx("div",{className:"post-options cursor-pointer ",onClick:()=>h(!j),children:e.jsx(ee,{size:35})}),j&&e.jsx("div",{className:"list absolute right-4 top-10 z-20",children:e.jsxs(we,{sx:{width:"100%",maxWidth:360,backgroundColor:"#121d33"},className:"rounded-md shadow-md ","aria-label":"contacts",onClick:()=>h(!1),children:[s.is_saved?e.jsx(A,{disablePadding:!0,onClick:()=>G(),children:e.jsx(P,{children:e.jsx(O,{primary:"Unsave",className:"px-5"})})}):e.jsx(A,{disablePadding:!0,onClick:()=>Y(),children:e.jsx(P,{children:e.jsx(O,{primary:"Save",className:"px-5"})})}),(t==null?void 0:t._id)!==s.user_id&&e.jsx(A,{disablePadding:!0,onClick:()=>K(),children:e.jsx(P,{children:e.jsx(O,{primary:"Report",className:"px-5"})})})]})})]}),e.jsxs("div",{className:"caption p-3 flex flex-col items-end",children:[e.jsx("span",{className:"w-full text-left text-sm overflow-hidden",style:{height:`${l?"auto":"20px"}`},children:s.caption}),l?e.jsx("button",{className:"text-xs text-slate-400",onClick:()=>r(!1),children:"Read Less"}):e.jsx("button",{className:"text-xs  text-slate-400",onClick:()=>r(!0),children:"Read More"})]}),e.jsxs("div",{className:"content p-2 relative",children:[s.type.includes("image")?e.jsx("img",{src:s==null?void 0:s.content,className:"w-full rounded-md"}):e.jsxs("div",{className:"relative",ref:v,children:[e.jsxs("video",{className:"w-full",loop:!0,muted:!0,ref:m,children:[e.jsx("source",{src:s==null?void 0:s.content,type:"video/mp4"}),"Error Message"]}),e.jsx("div",{className:"absolute bottom-1 volume-button rounded-full",onClick:()=>_(),children:i?e.jsx(se,{size:25}):e.jsx(te,{size:25})})]}),s.is_boosted&&e.jsxs("div",{className:"boost-action h-12 bg-gray-800 hover:bg-gray-600 rounded-md flex items-center px-3 border bottom-0 justify-between",onClick:X,children:[e.jsx("button",{children:s.is_boosted.action==="PROFILE_VISIT"?"Visit Profile":s.is_boosted.action==="WEBSITE"?"Visit Website":s.is_boosted.action==="MESSAGE"?"Message":null}),e.jsx(ve,{})]})]}),e.jsxs("footer",{className:"flex px-3 gap-3 items-center",children:[e.jsxs("div",{className:"likes flex items-center",children:[t&&s.likes.includes(t==null?void 0:t._id)?e.jsx("div",{className:"like",onClick:Z,children:e.jsx(re,{size:25})}):e.jsx("div",{className:"like",onClick:Q,children:e.jsx(ie,{size:25})}),e.jsxs("span",{className:"text-xs",onClick:()=>p(!0),children:[s.likes.length," Likes"]})]}),e.jsx("div",{className:"comments flex items-center",children:e.jsxs("div",{className:"comments",onClick:()=>x(!0),children:[e.jsx(ae,{size:25}),e.jsx("span",{className:"text-xs",children:s.comment})]})})]})]}),e.jsx(ye,{openModal:f,type:"DEFAULT",setOpenModal:x,post:s}),e.jsx(Ne,{openModal:w,setOpenModal:y,id:s._id,reported_type:"post"}),e.jsx(Me,{openModal:k,setOpenModal:p,post_id:s._id})]})}function Pe(){const s=I(),n=c.useRef(null),{posts:a,pagination:o,errorMessage:u,isLoading:t,isError:l,isSuccess:r}=N(i=>i.post);return c.useEffect(()=>{o==null&&a.length===0&&s(H(null))},[]),c.useEffect(()=>{var i,d;l&&C(u),r&&o!==((i=a[a.length-2])==null?void 0:i.createdAt)&&s(me((d=a[a.length-2])==null?void 0:d.createdAt)),s(B())},[l,u,r,s,a]),c.useEffect(()=>{const i=()=>{const d=document.body.clientHeight,m=window.scrollY,f=window.innerHeight;d-(m+f)<1&&s(H(o))};return window.addEventListener("scroll",i),()=>{window.removeEventListener("scroll",i)}},[s,o]),e.jsxs("div",{className:"mt-3 post-container overflow-y-auto",ref:n,children:[a&&a.map((i,d)=>e.jsx(Ae,{post:i},d)),t&&e.jsxs(e.Fragment,{children:[e.jsx(E,{variant:"rectangular",sx:{maxWidth:"50%"}}),e.jsx(E,{variant:"circular",width:60,height:60}),e.jsx(E,{variant:"rectangular",sx:{maxWidth:"50%"}}),e.jsx(E,{variant:"rounded",sx:{maxWidth:"50%"}})]})]})}function Oe(){const s=I(),n=$(),{userProfile:a}=N(r=>r.user),{user:o}=N(r=>r.auth),{myStory:u,story:t,isSuccess:l}=N(r=>r.story);return c.useEffect(()=>{(async()=>(s(xe()),s(fe())))()},[s]),c.useEffect(()=>{l&&s(he())},[l,s]),e.jsx("section",{className:"story-section flex items-center gap-5 bg-gray-900 h-32 rounded-md ps-3 shadow-md",children:e.jsxs("div",{className:"my-story flex items-center justify-center relative ",children:[e.jsxs("div",{className:"profile p-1 rounded-full cursor-pointer relative",onClick:()=>{u.length!==0&&n("/my-story")},children:[a!=null&&a.profile_img?e.jsx("img",{src:a==null?void 0:a.profile_img,alt:"",className:"w-20 h-20 rounded-full shadow-md"}):e.jsx("div",{className:"text-7xl flex items-center justify-center pb-1 w-20 h-20 bg-gray-400 rounded-full text-white",children:e.jsx("h1",{children:o==null?void 0:o.email[0]})}),u.length===0&&e.jsx("div",{className:"absolute right-0 bottom-0",onClick:()=>n("/add-story"),children:e.jsx(ge,{size:40})})]}),e.jsx("div",{className:"stories-list max-w-2/3 overflow-x-scroll flex gap-5 ms-4",children:t&&t.map((r,i)=>{var d,m,f;return e.jsx("div",{className:"w-20 h-20 rounded-full cursor-pointer",onClick:()=>n(`/view-story/${i}`),children:(d=r.user_details)!=null&&d.profile_img?e.jsx("img",{src:(m=r.user_details)==null?void 0:m.profile_img,alt:"",className:"w-20 h-20 rounded-full shadow-md"}):e.jsx("div",{className:"text-5xl flex items-center justify-center pb-1 w-20 h-20 bg-gray-400 rounded-full text-white",children:e.jsx("h1",{children:(f=r.user_details.email)==null?void 0:f.email[0].toUpperCase()})})},i)})})]})})}function es(){const s=I(),[n,a]=c.useState([]);c.useEffect(()=>{(async()=>{try{const t=await L.get("/users",{withCredentials:!0});t.data&&a(t.data.suggestion)}catch(t){const l=t;C.error(l.message)}})()},[]),c.useEffect(()=>{(async()=>s(je()))()},[s]);function o(t){(async()=>{try{(await L.post("/users",{id:t})).data&&a(r=>r.map(i=>(i.user_id===t&&(i.followed=!0),i)))}catch(l){const r=l;C.error(r.message)}})()}function u(t){(async()=>{try{(await L.post("/users/unfollow",{id:t},{withCredentials:!0})).data&&a(r=>r.map(i=>(i.user_id===t&&(i.followed=!1),i)))}catch(l){const r=l;C.error(r.message)}})()}return e.jsxs("div",{className:"flex flex-col",children:[e.jsx(pe,{}),e.jsxs("div",{className:"section md:ms-80 w-full md:w-auto md:py-5",children:[e.jsx(Oe,{}),e.jsxs("section",{className:"body grid grid-cols-12",children:[e.jsx("div",{className:"post col-span-12 lg:col-span-6",children:e.jsx(Pe,{})}),e.jsxs("div",{className:"right-section hidden col-span-6 lg:flex flex-col mt-3 p-5",children:[e.jsx("div",{className:"suggestions flex flex-col items-center",children:e.jsxs("div",{className:"suggestion-container",children:[n.length>0&&e.jsx("h1",{className:"text-lg mb-10",children:"Suggestions for you"}),n&&n.map(t=>e.jsxs("div",{className:"user-suggestion-card  mt-3 flex justify-between max-w-96 gap-3",children:[e.jsxs("div",{className:"profile flex gap-3",children:[t.profile_img?e.jsx("img",{src:t.profile_img,alt:"",className:"w-10 h-10 rounded-md"}):e.jsx("div",{className:"icon-with-text",children:e.jsx(D,{email:t.email,size:"small"})}),e.jsx("h1",{className:"text-lg",children:t.username})]}),t.followed?e.jsx("button",{className:" px-5 rounded-md h-7 hover:bg-slate-500",onClick:()=>u(t.user_id),children:"Unfollow"}):e.jsx("button",{className:" px-5 rounded-md h-7 hover:bg-slate-500",onClick:()=>o(t.user_id),children:"Follow"})]},t._id))]})}),e.jsxs("div",{className:"box flex flex-col items-center mt-28 border  max-w-64 self-center p-5  py-10 rounded-md",children:[e.jsx("h1",{className:"text-gray-400",children:'"Connect, Share, Inspire '}),e.jsx("h1",{className:"text-gray-400",children:'Your Social Oasis Awaits!"'})]})]})]})]})]})}export{es as default};
