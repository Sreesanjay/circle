import{H as z,u as k,m as U,a as H,r as a,I as B,i as P,Q as M,v as A,j as e,L as T,J as Z,K as G,f as V,P as $,h as W,M as Y,G as J,N as K,O as L,F as Q,S as X,U as ee,y as se,V as ae,W as te}from"./index-CBleMDpS.js";import{F as ie}from"./index.esm-BDjlgOjv.js";import{F as ne}from"./index.esm-OW_nijuq.js";import{I as le}from"./index.esm-XXqtGGVV.js";import{R as re}from"./Report-R9i70oKU.js";import{M as C}from"./Toast-wohdwbQC.js";import{I as ce}from"./ImageCrop-ZRyWReFt.js";import{D as oe}from"./DiscussionCard-kC7YVfoX.js";function de(j){return z({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M18 8H20C20.5523 8 21 8.44772 21 9V21C21 21.5523 20.5523 22 20 22H4C3.44772 22 3 21.5523 3 21V9C3 8.44772 3.44772 8 4 8H6V7C6 3.68629 8.68629 1 12 1C15.3137 1 18 3.68629 18 7V8ZM16 8V7C16 4.79086 14.2091 3 12 3C9.79086 3 8 4.79086 8 7V8H16ZM7 11V13H9V11H7ZM7 14V16H9V14H7ZM7 17V19H9V17H7Z"}}]})(j)}function xe({showModal:j,setShowModal:c,community:s,setCommunity:b}){const{isLoading:l,isSuccess:o,isError:p,errorMessage:h}=k(d=>d.community),r=U(),u=H(),[x,_]=a.useState([]),[f,m]=a.useState(!1),[g,i]=a.useState({community_name:"",topic:"",privacy:"public",about:""}),[w,n]=a.useState(),[v,E]=a.useState(""),[S,D]=a.useState("");a.useEffect(()=>{w&&(async()=>{const d=new File([w],"icon",{type:w.type}),N=await B(d);D(N)})()},[w]),a.useEffect(()=>{s&&i({community_name:s==null?void 0:s.community_name,topic:s==null?void 0:s.topic,privacy:s==null?void 0:s.privacy,about:s==null?void 0:s.about})},[s]),a.useEffect(()=>{(async()=>{var d;try{const N=await P.get("/manage-account/interest");N.data&&_(N.data.interest)}catch(N){const t=N;M.error((d=t.response)==null?void 0:d.data.message)}})()},[]);function I(d){const{name:N,value:t}=d.target;i({...g,[N]:t})}a.useEffect(()=>{p&&M.error(h),o&&c(!1),(p||o)&&u(A())},[p,o,u,h,r,c]);function F(d){d.target.files&&(E(URL.createObjectURL(d.target.files[0])),m(!0))}async function R(){if(g.community_name&&g.topic&&s){const d=await u(Z({formData:{...g,icon:S},id:s._id}));d.payload.community&&(b({...s,community_name:d.payload.community.community_name,topic:d.payload.community.topic,about:d.payload.community.about,privacy:d.payload.community.privacy,icon:d.payload.community.icon}),c(!1))}}return e.jsxs(e.Fragment,{children:[l?e.jsx(T,{}):e.jsxs(C,{show:j,size:"2xl",onClose:()=>{c(!1)},popup:!0,children:[e.jsx(C.Header,{children:e.jsx("div",{className:"p-4",children:"New Community"})}),e.jsxs(C.Body,{children:[e.jsxs("div",{className:"icon flex flex-col",children:[e.jsx("label",{htmlFor:"",className:"font-medium",children:"Choose icon"}),e.jsx("input",{type:"file",className:"rounded-md",onChange:F})]}),e.jsxs("div",{className:"input-group flex flex-col mt-4",children:[e.jsx("label",{htmlFor:"",className:"font-medium",children:"Community Name"}),e.jsx("input",{type:"text",name:"community_name",id:"",value:g.community_name,className:"rounded-md",onChange:I})]}),e.jsxs("div",{className:"flex gap-3 w-full justify-between",children:[e.jsxs("div",{className:"input-group flex flex-col mt-5 w-full",children:[e.jsx("label",{htmlFor:"",className:"font-medium",children:"Choose a Topic"}),e.jsx("select",{name:"topic",id:"",className:"rounded-md",onChange:I,value:g.topic,children:x.map((d,N)=>e.jsx("option",{value:d._id,children:d.interest},N))})]}),e.jsxs("div",{className:"input-group flex flex-col mt-5 mb-5 w-full",children:[e.jsx("label",{htmlFor:"",className:"font-medium",children:"Privacy"}),e.jsxs("select",{name:"privacy",id:"",className:"rounded-md",onChange:I,value:g.privacy,children:[e.jsx("option",{value:"public",children:"Public"}),e.jsx("option",{value:"private",children:"Private"})]})]})]}),e.jsxs("div",{className:"input-group flex flex-col mt-5",children:[e.jsx("label",{htmlFor:"",className:"font-medium",children:"About"}),e.jsx("textarea",{name:"about",id:"",className:"rounded-md",value:g.about,onChange:I})]}),e.jsxs("div",{className:"btn py-5",children:[e.jsx("button",{className:"btn px-5 py-1 bg-red-700 hover:bg-red-500 rounded-md text-white",onClick:()=>{s&&i({community_name:s==null?void 0:s.community_name,topic:s.topic,privacy:s.privacy,about:s.about})},children:"Clear"}),e.jsx("button",{className:"btn px-5 py-1 bg-primary hover:bg-primary-hover ms-3 rounded-md text-white",onClick:R,children:"Update"})]})]})]}),e.jsx(ce,{src:v,aspect:1/1,isCrop:f,setisCrop:m,setImage:n})]})}function pe({openDrawer:j,setOpenDrawer:c,community:s,setCommunity:b}){const l=U(),[o,p]=a.useState([]),[h,r]=a.useState(""),[u,x]=a.useState(!1),[_,f]=a.useState(!1),[m,g]=a.useState(!1),{user:i}=k(n=>n.auth);a.useEffect(()=>{(async()=>{const n=s==null?void 0:s.members.filter(v=>v.status==="active").map(v=>v.user_id);if(n){const v=await G(n);v.members&&p(v.members)}})()},[s]),a.useEffect(()=>{s&&s.members.map(n=>(n.is_admin&&r(n.user_id),n))},[s]),a.useEffect(()=>{s&&i&&s.members.map(n=>(n.user_id===(i==null?void 0:i._id)&&x(!0),n))},[s,i]);async function w(n){const v={user_id:n,community_id:s==null?void 0:s._id};(await Y(v)).member&&s&&(s.members=s==null?void 0:s.members.filter(S=>S.user_id!==n),b(s),p(S=>S.filter(D=>D.user_id!==n)),n===(i==null?void 0:i._id)&&(x(!1),s.privacy==="private"&&l("/community/recent_discussions")))}return e.jsxs("div",{children:[e.jsxs(V,{anchor:"right",open:j,onClose:()=>c(!1),children:[e.jsx("div",{className:"btn text-3xl px-10 py-3 bg-gray-700 sm:hidden",onClick:()=>c(!1),children:e.jsx(le,{})}),e.jsxs("div",{className:"container bg-gray-900 w-96 h-screen p-5 flex flex-col items-center",children:[e.jsx("div",{className:"icon h-28 w-28 bg-gray-700 rounded-full flex items-center justify-center relative",children:s!=null&&s.icon?e.jsx("img",{src:s.icon,alt:""}):e.jsx("h1",{className:"text-5xl text-white",children:s==null?void 0:s.community_name[0].toUpperCase()})}),e.jsx("h1",{className:"text-2xl text-white mt-5",children:s==null?void 0:s.community_name}),u&&e.jsxs("div",{className:"exit-report-btn py-3",children:[e.jsx("button",{className:"btn px-5 py-1 bg-red-500 hover:bg-red-700 text-white rounded-md",onClick:()=>w(i==null?void 0:i._id),children:"Exit"}),(i==null?void 0:i._id)!==h?e.jsx("button",{className:"btn px-5 py-1 ms-3 bg-primary hover:bg-primary-hover text-white rounded-md",onClick:()=>{f(!0),c(!1)},children:"Report"}):e.jsx("button",{className:"btn px-5 py-1 ms-3 bg-primary hover:bg-primary-hover text-white rounded-md",onClick:()=>{g(!0),c(!1)},children:"Edit"})]}),e.jsxs("div",{className:"drawer-body w-full p-5 text-white pt-10",children:[e.jsx("h1",{className:"text-xl mb-5",children:"Members"}),e.jsx("div",{className:"members max-h-96 overflow-y-scroll",children:o&&o.map((n,v)=>e.jsxs("div",{className:"user-card mb-4 bg-gray-800 p-2 rounded-md flex justify-between items-center",children:[e.jsxs("div",{className:"profile flex gap-3",children:[n.profile_img?e.jsx("img",{src:n.profile_img,alt:"",className:"w-10 h-10"}):e.jsx($,{email:n.email,size:"small"}),e.jsxs("div",{className:"name flex items-center",children:[e.jsx("h1",{className:"text-lg",children:n.username}),n.user_id===(i==null?void 0:i._id)&&e.jsx("p",{className:"",children:"(You)"})]})]}),e.jsx("div",{className:"actions",children:n.user_id===h?e.jsx("p",{className:"text-sm",children:"Admin"}):(i==null?void 0:i._id)===h&&e.jsx("div",{className:"remove",onClick:()=>w(n.user_id),children:e.jsx(W,{size:25})})})]},v))})]})]})]}),s&&e.jsxs(e.Fragment,{children:[e.jsx(re,{openModal:_,setOpenModal:f,id:s._id,reported_type:"community"}),e.jsx(xe,{showModal:m,setShowModal:g,community:s,setCommunity:b})]})]})}function ue({openDrawer:j,setOpenDrawer:c,community:s,setCommunity:b}){const l=H(),[o,p]=a.useState([]);a.useEffect(()=>{s&&(async()=>{var r;try{const u=await P.get(`/community/pending-request/${s._id}`);u.data.userList&&p(u.data.userList)}catch(u){const x=u;M.error((r=x.response)==null?void 0:r.data.message)}})()},[s]);async function h(r){s&&(await l(K({id:s._id,user_id:r}))).payload.member&&(p(x=>x.filter(_=>_.user_id!==r)),s&&b({...s,members:s.members.map(x=>(x.user_id===r&&(x.status="active"),x))}))}return e.jsx("div",{children:e.jsx(V,{anchor:"right",open:j,onClose:()=>c(!1),children:e.jsxs("div",{className:"container bg-gray-900 w-96 h-screen p-5 flex flex-col",children:[e.jsx("h1",{className:"text-xl text-white font-medium",children:"New Requests"}),o&&o.map(r=>e.jsxs("div",{className:"member-request-card w-full flex justify-between bg-gray-800 p-2 rounded-md",children:[e.jsxs("div",{className:"flex gap-3",children:[r.userProfile.profile_img?e.jsx("img",{src:r.userProfile.profile_img,alt:"",className:"w-10 h-10 rounded-full"}):e.jsx("div",{className:"w-10 h-10 bg-gray-900 rounded-full",children:e.jsx("h1",{children:r.userProfile.email[0]})}),e.jsx("h1",{className:"text-2xl text-slate-400",children:r.userProfile.username})]}),e.jsx("div",{className:"add-btn text-4xl text-white cursor-pointer",onClick:()=>h(r.user_id),children:e.jsx(J,{})})]}))]})})})}function me({openModal:j,setOpenModal:c,community:s,setDiscussion:b}){const{user:l}=k(r=>r.auth),[o,p]=a.useState("");async function h(){if(o&&l&&s){const r={user_id:l==null?void 0:l._id,community_id:s==null?void 0:s._id,content:o,content_type:"TEXT"},u=await L(r);u.discussion&&(M.success("new discussion added"),b(x=>[u.discussion,...x]),p(""),c(!1))}}return e.jsx(C,{show:j,size:"xl",onClose:()=>c(!1),popup:!0,children:e.jsxs(C.Body,{className:"bg-gray-800 border text-white",children:[e.jsx(C.Header,{}),e.jsx("h1",{className:"text-xl font-medium",children:"New Discussion"}),e.jsx("textarea",{name:"content",id:"",cols:60,rows:5,className:"rounded-md bg-gray-700 my-5 text-sm",onChange:r=>p(r.target.value),value:o}),e.jsxs("div",{className:"btn-group flex gap-3",children:[e.jsx("button",{className:"btn px-3 py-1 bg-red-600 hover:bg-red-800 rounded-md",onClick:()=>p(""),children:"Clear"}),e.jsx("button",{className:"btn px-3 py-1 bg-primary hover:bg-primary-hover rounded-md",onClick:()=>h(),children:"Submit"})]})]})})}function he({showUploadImage:j,setshowUploadImage:c,community:s,setDiscussion:b}){const[l,o]=a.useState(null),[p,h]=a.useState(null),[r,u]=a.useState(""),{user:x}=k(m=>m.auth);a.useEffect(()=>{l&&h(URL.createObjectURL(l))},[l]);function _(){o(null),h(null),c(!1)}async function f(){if(l&&x&&s){const m=l.type.includes("image")?"IMAGE":"VIDEO",g={user_id:x==null?void 0:x._id,community_id:s,content:l,caption:r,content_type:"MEDIA",file_type:m},i=await L(g);i.discussion&&(M.success("new discussion added"),b(w=>[i.discussion,...w]),o(null),h(null),c(!1))}}return e.jsx(e.Fragment,{children:e.jsx(C,{show:j,size:"lg",onClose:_,popup:!0,children:e.jsxs(C.Body,{className:"bg-gray-900 border rounded-md",children:[e.jsx(C.Header,{}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-xl font-medium text-white",children:"Upload a image or video"}),e.jsxs("div",{children:[e.jsx("div",{className:"preview p-5",children:p&&(l!=null&&l.type.includes("image")?e.jsx("img",{src:p,alt:"",className:"h-56"}):e.jsx("video",{src:p,className:"h-56",autoPlay:!0}))}),e.jsx("input",{type:"file",name:"media",className:"bg-gray-700 w-full rounded-md",onChange:m=>{m.target.files&&o(m.target.files[0])}}),e.jsxs("div",{className:"grp my-5",children:[e.jsx("label",{htmlFor:"",className:"text-white",children:"Caption"}),e.jsx("textarea",{className:"w-full  bg-gray-700 rounded-md my-2 text-white",onChange:m=>u(m.target.value)})]}),e.jsxs("div",{className:"btn-group",children:[e.jsx("button",{className:"clear bg-red-600 px-4 py-2 rounded-md text-white",onClick:()=>{o(null),h(null)},children:"Clear"}),e.jsx("button",{className:"clear ms-3 bg-primary px-4 py-2 rounded-md text-white",onClick:f,children:"Submit"})]})]})]})]})})})}function Ce(){const j=U(),c=H(),[s,b]=a.useState(null),{user:l}=k(t=>t.auth),{id:o}=Q(),[p,h]=a.useState(!1),[r,u]=a.useState(!1),[x,_]=a.useState(!1),[f,m]=a.useState([]),[g,i]=a.useState(!1),[w,n]=a.useState("hidden"),v=a.useRef(null),[E,S]=a.useState({total_members:0,total_discussion:0,discussions_today:0}),{myCommunity:D,isSuccess:I,isError:F}=k(t=>t.community),[R,d]=a.useState(null);a.useEffect(()=>{s&&(async()=>{const t=await X(s._id);t.analytics&&S(t.analytics)})()},[s]);async function N(){if(s){let t=null;f.length&&s._id===f[0].community_id&&(t=f.length>0?f[f.length-1].createdAt:null);const y=await te(s._id,t);y.discussions&&m(t===null?y.discussions:[...f,...y.discussions])}}return a.useEffect(()=>{s&&N()},[s]),a.useEffect(()=>{if(s&&l){const t=s.members.filter(y=>y.user_id===(l==null?void 0:l._id));d(t[0])}},[s,l]),a.useEffect(()=>{o&&(async()=>{const t=await ee(o);b(t.community)})()},[o]),a.useEffect(()=>{c(se())},[c]),a.useEffect(()=>{c(A())},[I,F,c]),a.useEffect(()=>{const t=()=>{const y=document.body.clientHeight,O=window.scrollY,q=window.innerHeight;y-(O+q)<1&&N()};return window.addEventListener("scroll",t),()=>{window.removeEventListener("scroll",t)}},[c,f]),e.jsxs("section",{className:"view-community grid grid-cols-12 relative",children:[e.jsx("section",{className:`col-span-12 ${w} sm:block sm:col-span-5 md:col-span-5 lg:col-span-3 z-20`,onClick:()=>n("hidden"),children:e.jsxs("div",{className:"left-side-bar fixed bg-gray-900 w-full sm:w-auto 2xl:w-96  pt-5 px-3",children:[e.jsx("h1",{className:"mb-8 text-2xl",children:"Community"}),e.jsx("div",{className:"discover-community w-full bg-gray-800 py-3 rounded-md hover:bg-gray-700 cursor-pointer",onClick:()=>j("/community/discover"),children:e.jsx("h1",{className:"text-center",children:"Discover Communities"})}),e.jsx("h1",{className:"your-community text-lg my-5",children:"Your Communities"}),D&&D.map((t,y)=>e.jsxs("div",{className:`community-choose-card mb-3 flex gap-3 overflow-hidden items-center ${t._id!==o?"bg-gray-800":"bg-gray-700"} hover:bg-gray-700 p-1 px-2 rounded-md cursor-pointer`,onClick:()=>{j(`/community/view/${t._id}`)},children:[e.jsx("div",{className:"icon w-14 h-14 bg-gray-700 rounded-full flex items-center justify-center shadow-lg relative",children:t!=null&&t.icon?e.jsx("img",{src:t.icon,alt:""}):e.jsx("h1",{className:"text-xl",children:t==null?void 0:t.community_name[0].toUpperCase()})}),e.jsx("div",{className:"deatils",children:e.jsx("h1",{className:"text-lg",children:t.community_name})})]},y))]})}),e.jsxs("section",{className:"body col-span-12 sm:col-span-7 md:col-span-7 lg:col-span-9",children:[e.jsxs("header",{className:"header flex justify-between shadow-lg p-2 px-5",children:[e.jsxs("div",{className:"profile flex gap-3",children:[e.jsxs("div",{className:"icon h-16 w-28  rounded-md flex items-center justify-center relative",children:[s!=null&&s.icon?e.jsx("img",{src:s.icon,alt:"",className:"h-14 w-14 rounded-md"}):e.jsx("h1",{className:"text-2xl bg-gray-700 px-8 py-3 rounded-md",children:s==null?void 0:s.community_name[0].toUpperCase()}),e.jsx("button",{className:"sm:hidden cursor-pointer btn absolute z-20 w-full h-full",onClick:()=>n("block")})]}),e.jsx("h1",{className:"text-2xl",onClick:()=>h(!0),children:s==null?void 0:s.community_name})]}),R&&R.is_admin&&e.jsx("button",{className:"text-2xl",onClick:()=>u(!0),children:e.jsx(ie,{})})]}),e.jsxs("body",{className:"container grid grid-cols-12 p-5",children:[e.jsxs("section",{className:"discussion-section col-span-12 lg:col-span-8",children:[e.jsxs("div",{className:"new-discusssion flex items-center gap-3",children:[e.jsx("div",{className:"file-upload-button text-3xl text-primary ",onClick:()=>i(!0),children:e.jsx(ne,{})}),e.jsx("input",{type:"hidden"}),e.jsx("button",{className:"new-text-discussion-input w-5/6 h-12 rounded bg-gray-700 flex justify-start items-center px-3 text-slate-500",onClick:()=>_(!0),children:"Write Something"}),e.jsx("div",{className:"send-icon",children:e.jsx(ae,{size:35})})]}),e.jsx("div",{className:"discussions w-full flex flex-col items-center py-5 sm:p-5",ref:v,children:f==null?void 0:f.map((t,y)=>e.jsx(oe,{discussion:t,setDiscussion:m,type:"DEFAULT"},y))})]}),e.jsxs("div",{className:"right-section hidden lg:block sm:col-span-4 bg-gray-900 p-5 rounded-md",children:[e.jsx("h1",{className:"text-lg",children:"About"}),e.jsx("p",{className:"text-sm py-2 pb-5",children:s==null?void 0:s.about}),(s==null?void 0:s.privacy)==="public"?e.jsxs("div",{className:"",children:[e.jsx("h1",{className:"text-lg",children:"Public"}),e.jsx("p",{className:"text-sm py-2 pb-5",children:"Everyone can see discussions"})]}):e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"flex items-center gap-2 text-lg",children:[e.jsx(de,{}),e.jsx("h1",{className:"text-lg",children:"Private"})]}),e.jsx("p",{className:"text-sm py-5",children:"Only the members of this community are allowed to see discussions"})]}),e.jsx("h1",{className:"text-lg",children:"Activity"}),e.jsx("div",{className:"analytics",children:e.jsxs("ul",{className:"flex flex-col gap-3 mt-5",children:[e.jsxs("li",{children:[E.discussions_today," ","Discussions today"]}),e.jsxs("li",{children:[E.total_discussion," Total discussions"," "]}),e.jsxs("li",{children:[E.total_members," members"]})]})})]})]})]}),e.jsx(pe,{openDrawer:p,setOpenDrawer:h,community:s,setCommunity:b}),e.jsx(ue,{openDrawer:r,setOpenDrawer:u,community:s,setCommunity:b}),e.jsx(me,{openModal:x,setOpenModal:_,community:s,setDiscussion:m}),s&&e.jsx(he,{showUploadImage:g,setshowUploadImage:i,community:s._id,setDiscussion:m})]})}export{Ce as default};
