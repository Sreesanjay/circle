import{H as O,u as I,m as U,a as H,r as a,I as T,i as P,Q as M,v as A,j as e,L as B,J as Z,K as $,f as V,P as G,h as W,M as Y,G as J,N as K,O as L,F as Q,S as X,U as ee,y as se,V as ae,W as te}from"./index-3YDLuNXw.js";import{F as ie}from"./index.esm-p0Xvwv85.js";import{F as ne}from"./index.esm-djVzRIMr.js";import{I as le}from"./index.esm-fgCdGJCs.js";import{R as re}from"./Report-NhXNTEZQ.js";import{M as _}from"./Toast-XyGuMU90.js";import{I as ce}from"./ImageCrop-oBSh4WDp.js";import{P as oe}from"./PopupModal-sy7AnXjJ.js";import{D as de}from"./DiscussionCard-IEoZjbc-.js";function xe(b){return O({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M18 8H20C20.5523 8 21 8.44772 21 9V21C21 21.5523 20.5523 22 20 22H4C3.44772 22 3 21.5523 3 21V9C3 8.44772 3.44772 8 4 8H6V7C6 3.68629 8.68629 1 12 1C15.3137 1 18 3.68629 18 7V8ZM16 8V7C16 4.79086 14.2091 3 12 3C9.79086 3 8 4.79086 8 7V8H16ZM7 11V13H9V11H7ZM7 14V16H9V14H7ZM7 17V19H9V17H7Z"}}]})(b)}function ue({showModal:b,setShowModal:o,community:s,setCommunity:v}){const{isLoading:l,isSuccess:d,isError:u,errorMessage:h}=I(r=>r.community),c=U(),p=H(),[x,w]=a.useState([]),[f,m]=a.useState(!1),[g,n]=a.useState({community_name:"",topic:"",privacy:"public",about:""}),[C,S]=a.useState(),[D,E]=a.useState(""),[R,k]=a.useState("");a.useEffect(()=>{C&&(async()=>{const r=new File([C],"icon",{type:C.type}),j=await T(r);k(j)})()},[C]),a.useEffect(()=>{s&&n({community_name:s==null?void 0:s.community_name,topic:s==null?void 0:s.topic,privacy:s==null?void 0:s.privacy,about:s==null?void 0:s.about})},[s]),a.useEffect(()=>{(async()=>{var r;try{const j=await P.get("/manage-account/interest");j.data&&w(j.data.interest)}catch(j){const t=j;M.error((r=t.response)==null?void 0:r.data.message)}})()},[]);function i(r){const{name:j,value:t}=r.target;n({...g,[j]:t})}a.useEffect(()=>{u&&M.error(h),d&&o(!1),(u||d)&&p(A())},[u,d,p,h,c,o]);function N(r){r.target.files&&(E(URL.createObjectURL(r.target.files[0])),m(!0))}async function F(){if(g.community_name&&g.topic&&s){const r=await p(Z({formData:{...g,icon:R},id:s._id}));r.payload.community&&(v({...s,community_name:r.payload.community.community_name,topic:r.payload.community.topic,about:r.payload.community.about,privacy:r.payload.community.privacy,icon:r.payload.community.icon}),o(!1))}}return e.jsxs(e.Fragment,{children:[l?e.jsx(B,{}):e.jsxs(_,{show:b,size:"2xl",onClose:()=>{o(!1)},popup:!0,children:[e.jsx(_.Header,{children:e.jsx("div",{className:"p-4",children:"New Community"})}),e.jsxs(_.Body,{children:[e.jsxs("div",{className:"icon flex flex-col",children:[e.jsx("label",{htmlFor:"",className:"font-medium",children:"Choose icon"}),e.jsx("input",{type:"file",className:"rounded-md",onChange:N})]}),e.jsxs("div",{className:"input-group flex flex-col mt-4",children:[e.jsx("label",{htmlFor:"",className:"font-medium",children:"Community Name"}),e.jsx("input",{type:"text",name:"community_name",id:"",value:g.community_name,className:"rounded-md",onChange:i})]}),e.jsxs("div",{className:"flex gap-3 w-full justify-between",children:[e.jsxs("div",{className:"input-group flex flex-col mt-5 w-full",children:[e.jsx("label",{htmlFor:"",className:"font-medium",children:"Choose a Topic"}),e.jsx("select",{name:"topic",id:"",className:"rounded-md",onChange:i,value:g.topic,children:x.map((r,j)=>e.jsx("option",{value:r._id,children:r.interest},j))})]}),e.jsxs("div",{className:"input-group flex flex-col mt-5 mb-5 w-full",children:[e.jsx("label",{htmlFor:"",className:"font-medium",children:"Privacy"}),e.jsxs("select",{name:"privacy",id:"",className:"rounded-md",onChange:i,value:g.privacy,children:[e.jsx("option",{value:"public",children:"Public"}),e.jsx("option",{value:"private",children:"Private"})]})]})]}),e.jsxs("div",{className:"input-group flex flex-col mt-5",children:[e.jsx("label",{htmlFor:"",className:"font-medium",children:"About"}),e.jsx("textarea",{name:"about",id:"",className:"rounded-md",value:g.about,onChange:i})]}),e.jsxs("div",{className:"btn py-5",children:[e.jsx("button",{className:"btn px-5 py-1 bg-red-700 hover:bg-red-500 rounded-md text-white",onClick:()=>{s&&n({community_name:s==null?void 0:s.community_name,topic:s.topic,privacy:s.privacy,about:s.about})},children:"Clear"}),e.jsx("button",{className:"btn px-5 py-1 bg-primary hover:bg-primary-hover ms-3 rounded-md text-white",onClick:F,children:"Update"})]})]})]}),e.jsx(ce,{src:D,aspect:1/1,isCrop:f,setisCrop:m,setImage:S})]})}function pe({openDrawer:b,setOpenDrawer:o,community:s,setCommunity:v}){const l=U(),[d,u]=a.useState([]),[h,c]=a.useState(""),[p,x]=a.useState(!1),[w,f]=a.useState(!1),[m,g]=a.useState(!1),{user:n}=I(i=>i.auth),[C,S]=a.useState(!1);a.useEffect(()=>{(async()=>{const i=s==null?void 0:s.members.filter(N=>N.status==="active").map(N=>N.user_id);if(i){const N=await $(i);N.members&&u(N.members)}})()},[s]),a.useEffect(()=>{s&&s.members.map(i=>(i.is_admin&&c(i.user_id),i))},[s]),a.useEffect(()=>{s&&n&&s.members.map(i=>(i.user_id===(n==null?void 0:n._id)&&x(!0),i))},[s,n]);async function D(i){const N={user_id:i,community_id:s==null?void 0:s._id};(await Y(N)).member&&s&&(s.members=s==null?void 0:s.members.filter(r=>r.user_id!==i),v(s),u(r=>r.filter(j=>j.user_id!==i)),i===(n==null?void 0:n._id)&&(x(!1),s.privacy==="private"&&l("/community/recent_discussions")))}async function E(){(await P.put(`/community/remove/${s==null?void 0:s._id}`)).data&&(o(!1),M.success("community deleted"),l("/community/recent_discussions"))}function R(){S(!0)}function k(){S(!1)}return e.jsxs("div",{children:[e.jsx(oe,{modalState:C,message:"Are you sure you want to delete this community?",posText:"Delete",negText:"No",successCallback:E,cancelCallback:k}),e.jsxs(V,{anchor:"right",open:b,onClose:()=>o(!1),children:[e.jsx("div",{className:"btn text-3xl px-10 py-3 bg-gray-700 sm:hidden",onClick:()=>o(!1),children:e.jsx(le,{})}),e.jsxs("div",{className:"container bg-gray-900 w-96 h-screen p-5 flex flex-col items-center",children:[e.jsx("div",{className:"icon h-28 w-28 bg-gray-700 rounded-full flex items-center justify-center relative",children:s!=null&&s.icon?e.jsx("img",{src:s.icon,alt:""}):e.jsx("h1",{className:"text-5xl text-white",children:s==null?void 0:s.community_name[0].toUpperCase()})}),e.jsx("h1",{className:"text-2xl text-white mt-5",children:s==null?void 0:s.community_name}),p&&e.jsxs("div",{className:"exit-report-btn py-3",children:[e.jsx("button",{className:"btn px-5 py-1 bg-red-500 hover:bg-red-700 text-white rounded-md",onClick:()=>D(n==null?void 0:n._id),children:"Exit"}),(n==null?void 0:n._id)!==h?e.jsx("button",{className:"btn px-5 py-1 ms-3 bg-primary hover:bg-primary-hover text-white rounded-md",onClick:()=>{f(!0),o(!1)},children:"Report"}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn px-5 py-1 ms-3 bg-primary hover:bg-primary-hover text-white rounded-md",onClick:()=>{g(!0),o(!1)},children:"Edit"}),e.jsx("button",{className:"btn px-5 py-1 ms-3 bg-primary hover:bg-primary-hover text-white rounded-md",onClick:R,children:"Delete"})]})]}),e.jsxs("div",{className:"drawer-body w-full p-5 text-white pt-10",children:[e.jsx("h1",{className:"text-xl mb-5",children:"Members"}),e.jsx("div",{className:"members max-h-96 overflow-y-scroll",children:d&&d.map((i,N)=>e.jsxs("div",{className:"user-card mb-4 bg-gray-800 p-2 rounded-md flex justify-between items-center",children:[e.jsxs("div",{className:"profile flex gap-3",children:[i.profile_img?e.jsx("img",{src:i.profile_img,alt:"",className:"w-10 h-10"}):e.jsx(G,{email:i.email,size:"small"}),e.jsxs("div",{className:"name flex items-center",children:[e.jsx("h1",{className:"text-lg",children:i.username}),i.user_id===(n==null?void 0:n._id)&&e.jsx("p",{className:"",children:"(You)"})]})]}),e.jsx("div",{className:"actions",children:i.user_id===h?e.jsx("p",{className:"text-sm",children:"Admin"}):(n==null?void 0:n._id)===h&&e.jsx("div",{className:"remove",onClick:()=>D(i.user_id),children:e.jsx(W,{size:25})})})]},N))})]})]})]}),s&&e.jsxs(e.Fragment,{children:[e.jsx(re,{openModal:w,setOpenModal:f,id:s._id,reported_type:"community"}),e.jsx(ue,{showModal:m,setShowModal:g,community:s,setCommunity:v})]})]})}function me({openDrawer:b,setOpenDrawer:o,community:s,setCommunity:v}){const l=H(),[d,u]=a.useState([]);a.useEffect(()=>{s&&(async()=>{var c;try{const p=await P.get(`/community/pending-request/${s._id}`);p.data.userList&&u(p.data.userList)}catch(p){const x=p;M.error((c=x.response)==null?void 0:c.data.message)}})()},[s]);async function h(c){s&&(await l(K({id:s._id,user_id:c}))).payload.member&&(u(x=>x.filter(w=>w.user_id!==c)),s&&v({...s,members:s.members.map(x=>(x.user_id===c&&(x.status="active"),x))}))}return e.jsx("div",{children:e.jsx(V,{anchor:"right",open:b,onClose:()=>o(!1),children:e.jsxs("div",{className:"container bg-gray-900 w-96 h-screen p-5 flex flex-col",children:[e.jsx("h1",{className:"text-xl text-white font-medium",children:"New Requests"}),d&&d.map(c=>e.jsxs("div",{className:"member-request-card w-full flex justify-between bg-gray-800 p-2 rounded-md",children:[e.jsxs("div",{className:"flex gap-3",children:[c.userProfile.profile_img?e.jsx("img",{src:c.userProfile.profile_img,alt:"",className:"w-10 h-10 rounded-full"}):e.jsx("div",{className:"w-10 h-10 bg-gray-900 rounded-full",children:e.jsx("h1",{children:c.userProfile.email[0]})}),e.jsx("h1",{className:"text-2xl text-slate-400",children:c.userProfile.username})]}),e.jsx("div",{className:"add-btn text-4xl text-white cursor-pointer",onClick:()=>h(c.user_id),children:e.jsx(J,{})})]}))]})})})}function he({openModal:b,setOpenModal:o,community:s,setDiscussion:v}){const{user:l}=I(c=>c.auth),[d,u]=a.useState("");async function h(){if(d&&l&&s){const c={user_id:l==null?void 0:l._id,community_id:s==null?void 0:s._id,content:d,content_type:"TEXT"},p=await L(c);p.discussion&&(M.success("new discussion added"),v(x=>[p.discussion,...x]),u(""),o(!1))}}return e.jsx(_,{show:b,size:"xl",onClose:()=>o(!1),popup:!0,children:e.jsxs(_.Body,{className:"bg-gray-800 border text-white",children:[e.jsx(_.Header,{}),e.jsx("h1",{className:"text-xl font-medium",children:"New Discussion"}),e.jsx("textarea",{name:"content",id:"",cols:60,rows:5,className:"rounded-md bg-gray-700 my-5 text-sm",onChange:c=>u(c.target.value),value:d}),e.jsxs("div",{className:"btn-group flex gap-3",children:[e.jsx("button",{className:"btn px-3 py-1 bg-red-600 hover:bg-red-800 rounded-md",onClick:()=>u(""),children:"Clear"}),e.jsx("button",{className:"btn px-3 py-1 bg-primary hover:bg-primary-hover rounded-md",onClick:()=>h(),children:"Submit"})]})]})})}function fe({showUploadImage:b,setshowUploadImage:o,community:s,setDiscussion:v}){const[l,d]=a.useState(null),[u,h]=a.useState(null),[c,p]=a.useState(""),{user:x}=I(m=>m.auth);a.useEffect(()=>{l&&h(URL.createObjectURL(l))},[l]);function w(){d(null),h(null),o(!1)}async function f(){if(l&&x&&s){const m=l.type.includes("image")?"IMAGE":"VIDEO",g={user_id:x==null?void 0:x._id,community_id:s,content:l,caption:c,content_type:"MEDIA",file_type:m},n=await L(g);n.discussion&&(M.success("new discussion added"),v(C=>[n.discussion,...C]),d(null),h(null),o(!1))}}return e.jsx(e.Fragment,{children:e.jsx(_,{show:b,size:"lg",onClose:w,popup:!0,children:e.jsxs(_.Body,{className:"bg-gray-900 border rounded-md",children:[e.jsx(_.Header,{}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-xl font-medium text-white",children:"Upload a image or video"}),e.jsxs("div",{children:[e.jsx("div",{className:"preview p-5",children:u&&(l!=null&&l.type.includes("image")?e.jsx("img",{src:u,alt:"",className:"h-56"}):e.jsx("video",{src:u,className:"h-56",autoPlay:!0}))}),e.jsx("input",{type:"file",name:"media",className:"bg-gray-700 w-full rounded-md",onChange:m=>{m.target.files&&d(m.target.files[0])}}),e.jsxs("div",{className:"grp my-5",children:[e.jsx("label",{htmlFor:"",className:"text-white",children:"Caption"}),e.jsx("textarea",{className:"w-full  bg-gray-700 rounded-md my-2 text-white",onChange:m=>p(m.target.value)})]}),e.jsxs("div",{className:"btn-group",children:[e.jsx("button",{className:"clear bg-red-600 px-4 py-2 rounded-md text-white",onClick:()=>{d(null),h(null)},children:"Clear"}),e.jsx("button",{className:"clear ms-3 bg-primary px-4 py-2 rounded-md text-white",onClick:f,children:"Submit"})]})]})]})]})})})}function Ee(){const b=U(),o=H(),[s,v]=a.useState(null),{user:l}=I(t=>t.auth),{id:d}=Q(),[u,h]=a.useState(!1),[c,p]=a.useState(!1),[x,w]=a.useState(!1),[f,m]=a.useState([]),[g,n]=a.useState(!1),[C,S]=a.useState("hidden"),D=a.useRef(null),[E,R]=a.useState({total_members:0,total_discussion:0,discussions_today:0}),{myCommunity:k,isSuccess:i,isError:N}=I(t=>t.community),[F,r]=a.useState(null);a.useEffect(()=>{s&&(async()=>{const t=await X(s._id);t.analytics&&R(t.analytics)})()},[s]);async function j(){if(s){let t=null;f.length&&s._id===f[0].community_id&&(t=f.length>0?f[f.length-1].createdAt:null);const y=await te(s._id,t);y.discussions&&m(t===null?y.discussions:[...f,...y.discussions])}}return a.useEffect(()=>{s&&j()},[s]),a.useEffect(()=>{if(s&&l){const t=s.members.filter(y=>y.user_id===(l==null?void 0:l._id));r(t[0])}},[s,l]),a.useEffect(()=>{d&&(async()=>{const t=await ee(d);v(t.community)})()},[d]),a.useEffect(()=>{o(se())},[o]),a.useEffect(()=>{o(A())},[i,N,o]),a.useEffect(()=>{const t=()=>{const y=document.body.clientHeight,q=window.scrollY,z=window.innerHeight;y-(q+z)<1&&j()};return window.addEventListener("scroll",t),()=>{window.removeEventListener("scroll",t)}},[o,f]),e.jsxs("section",{className:"view-community grid grid-cols-12 relative",children:[e.jsx("section",{className:`col-span-12 ${C} sm:block sm:col-span-5 md:col-span-5 lg:col-span-3 z-20`,onClick:()=>S("hidden"),children:e.jsxs("div",{className:"left-side-bar fixed bg-gray-900 w-full sm:w-auto 2xl:w-96  pt-5 px-3",children:[e.jsx("h1",{className:"mb-8 text-2xl",children:"Community"}),e.jsx("div",{className:"discover-community w-full bg-gray-800 py-3 rounded-md hover:bg-gray-700 cursor-pointer",onClick:()=>b("/community/discover"),children:e.jsx("h1",{className:"text-center",children:"Discover Communities"})}),e.jsx("h1",{className:"your-community text-lg my-5",children:"Your Communities"}),k&&k.map((t,y)=>e.jsxs("div",{className:`community-choose-card mb-3 flex gap-3 overflow-hidden items-center ${t._id!==d?"bg-gray-800":"bg-gray-700"} hover:bg-gray-700 p-1 px-2 rounded-md cursor-pointer`,onClick:()=>{b(`/community/view/${t._id}`)},children:[e.jsx("div",{className:"icon w-14 h-14 bg-gray-700 rounded-full flex items-center justify-center shadow-lg relative",children:t!=null&&t.icon?e.jsx("img",{src:t.icon,alt:""}):e.jsx("h1",{className:"text-xl",children:t==null?void 0:t.community_name[0].toUpperCase()})}),e.jsx("div",{className:"deatils",children:e.jsx("h1",{className:"text-lg",children:t.community_name})})]},y))]})}),e.jsxs("section",{className:"body col-span-12 sm:col-span-7 md:col-span-7 lg:col-span-9",children:[e.jsxs("header",{className:"header flex justify-between shadow-lg p-2 px-5",children:[e.jsxs("div",{className:"profile flex gap-3",children:[e.jsxs("div",{className:"icon h-16 w-28  rounded-md flex items-center justify-center relative",children:[s!=null&&s.icon?e.jsx("img",{src:s.icon,alt:"",className:"h-14 w-14 rounded-md"}):e.jsx("h1",{className:"text-2xl bg-gray-700 px-8 py-3 rounded-md",children:s==null?void 0:s.community_name[0].toUpperCase()}),e.jsx("button",{className:"sm:hidden cursor-pointer btn absolute z-20 w-full h-full",onClick:()=>S("block")})]}),e.jsx("h1",{className:"text-2xl",onClick:()=>h(!0),children:s==null?void 0:s.community_name})]}),F&&F.is_admin&&e.jsx("button",{className:"text-2xl",onClick:()=>p(!0),children:e.jsx(ie,{})})]}),e.jsxs("body",{className:"container grid grid-cols-12 p-5",children:[e.jsxs("section",{className:"discussion-section col-span-12 lg:col-span-8",children:[e.jsxs("div",{className:"new-discusssion flex items-center gap-3",children:[e.jsx("div",{className:"file-upload-button text-3xl text-primary ",onClick:()=>n(!0),children:e.jsx(ne,{})}),e.jsx("input",{type:"hidden"}),e.jsx("button",{className:"new-text-discussion-input w-5/6 h-12 rounded bg-gray-700 flex justify-start items-center px-3 text-slate-500",onClick:()=>w(!0),children:"Write Something"}),e.jsx("div",{className:"send-icon",children:e.jsx(ae,{size:35})})]}),e.jsx("div",{className:"discussions w-full flex flex-col items-center py-5 sm:p-5",ref:D,children:f==null?void 0:f.map((t,y)=>e.jsx(de,{discussion:t,setDiscussion:m,type:"DEFAULT"},y))})]}),e.jsxs("div",{className:"right-section hidden lg:block sm:col-span-4 bg-gray-900 p-5 rounded-md",children:[e.jsx("h1",{className:"text-lg",children:"About"}),e.jsx("p",{className:"text-sm py-2 pb-5",children:s==null?void 0:s.about}),(s==null?void 0:s.privacy)==="public"?e.jsxs("div",{className:"",children:[e.jsx("h1",{className:"text-lg",children:"Public"}),e.jsx("p",{className:"text-sm py-2 pb-5",children:"Everyone can see discussions"})]}):e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"flex items-center gap-2 text-lg",children:[e.jsx(xe,{}),e.jsx("h1",{className:"text-lg",children:"Private"})]}),e.jsx("p",{className:"text-sm py-5",children:"Only the members of this community are allowed to see discussions"})]}),e.jsx("h1",{className:"text-lg",children:"Activity"}),e.jsx("div",{className:"analytics",children:e.jsxs("ul",{className:"flex flex-col gap-3 mt-5",children:[e.jsxs("li",{children:[E.discussions_today," ","Discussions today"]}),e.jsxs("li",{children:[E.total_discussion," Total discussions"," "]}),e.jsxs("li",{children:[E.total_members," members"]})]})})]})]})]}),e.jsx(pe,{openDrawer:u,setOpenDrawer:h,community:s,setCommunity:v}),e.jsx(me,{openDrawer:c,setOpenDrawer:p,community:s,setCommunity:v}),e.jsx(he,{openModal:x,setOpenModal:w,community:s,setDiscussion:m}),s&&e.jsx(fe,{showUploadImage:g,setshowUploadImage:n,community:s._id,setDiscussion:m})]})}export{Ee as default};
