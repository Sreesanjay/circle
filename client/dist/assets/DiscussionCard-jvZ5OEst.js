import{r as m,u as D,X as E,j as e,Y as k,Z as w,V as C,_ as I,$ as S,a0 as b,m as P,U as $,P as z,T as O,a1 as L,a2 as M,a3 as T}from"./index-APfY0OkE.js";import{a as V}from"./index.esm-XMoYRhP5.js";import{M as v,L as g}from"./Toast-UWSLTCrg.js";import{R as B}from"./Report-Yy6F3tUx.js";function F({openModal:i,setOpenModal:p,discussion:o}){const[r,x]=m.useState([]),{user:a}=D(s=>s.auth),[h,f]=m.useState("");m.useEffect(()=>{o&&(async()=>{const s=await E(o._id);s.comment&&x(s.comment)})()},[o]);function y(s){const n=document.getElementById(`reply-${s}`);n&&n.style.display!=="none"?n.style.display="none":n&&(n.style.display="block")}function c(s){const n=document.getElementById(`reply-inp-${s}`);n&&n.style.display!=="none"?n.style.display="none":n&&(n.style.display="flex")}async function j(s){(await I(s)).comment&&x(l=>l.map(t=>(t._id===s&&t.likes.push(a==null?void 0:a._id),t)))}async function u(s){(await S(s)).comment&&x(l=>l.map(t=>(t._id===s&&(t.likes=t.likes.filter(d=>d!==(a==null?void 0:a._id))),t)))}async function N(){if(a&&o){const s={user_id:a==null?void 0:a._id,discussion_id:o==null?void 0:o._id,content:h},n=await b(s);f(""),n.comment&&x(l=>[n.comment,...l])}}async function _(s){const n=document.getElementById(`inp-reply-${s}`);if(n&&a&&o){const l={user_id:a==null?void 0:a._id,discussion_id:o==null?void 0:o._id,content:n.value,reply:s},t=await b(l);t.comment&&x(d=>[t.comment,...d])}}return e.jsx(v,{show:i,size:"xl",onClose:()=>p(!1),popup:!0,children:e.jsxs(v.Body,{className:"bg-gray-800 border text-white overflow-hidden",children:[e.jsx(v.Header,{}),e.jsxs("section",{className:"comment-view min-h-96 flex flex-col justify-between relative",children:[r&&r.map((s,n)=>!s.reply&&e.jsxs("div",{className:"comment flex mb-3",children:[e.jsx("div",{className:"profile-icon",children:s.user_details.profile_img?e.jsx("img",{src:s.user_details.profile_img,alt:"",className:"w-9 h-9 rounded-full"}):e.jsx("div",{className:"icon-with-text",children:e.jsx("h1",{children:s.user_details.email})})}),e.jsxs("div",{className:"group w-full",children:[e.jsxs("div",{className:"content-body w-full p-3 bg-gray-900",children:[e.jsx("div",{className:"user-header h-10",children:e.jsx("div",{className:"user-details",children:e.jsx("h1",{className:"text-md",children:s.user_details.username})})}),e.jsx("div",{className:"content",children:e.jsx("p",{children:s.content})}),e.jsxs("div",{className:"footer flex justify-between items-center",children:[e.jsx("p",{className:"text-sm cursor-pointer mt-5 view-reply",onClick:()=>y(s._id),children:"View Replies"}),e.jsx("p",{className:"btn-reply text-sm cursor-pointer mt-5",onClick:()=>c(s._id),children:"Reply"}),e.jsxs("div",{className:"likes flex items-center",children:[e.jsx(e.Fragment,{children:s.likes.includes(a==null?void 0:a._id)?e.jsx("div",{className:"like",onClick:()=>u(s._id),children:e.jsx(k,{size:15})}):e.jsx("div",{className:"likes",onClick:()=>j(s._id),children:e.jsx(w,{size:15})})}),s.likes.length]})]})]}),e.jsxs("div",{className:" py-3 hidden",id:`reply-inp-${s._id}`,children:[e.jsx("input",{type:"text",id:`inp-reply-${s._id}`,placeholder:"Add your reply",className:"rounded-md bg-gray-700 w-full"}),e.jsx("div",{className:"",onClick:()=>_(s._id),children:e.jsx(C,{size:10})})]}),e.jsx("div",{className:"replies hidden mt-5",id:`reply-${s._id}`,children:e.jsx("div",{className:"reply-container",children:r.map((l,t)=>l.reply&&l.reply===s._id?e.jsxs("div",{className:"comment flex gap-3 mb-5",children:[e.jsx("div",{className:"profile-icon",children:l.user_details.profile_img?e.jsx("img",{src:l.user_details.profile_img,alt:"",className:"w-9 h-9 rounded-full"}):e.jsx("div",{className:"icon-with-text",children:e.jsx("h1",{children:l.user_details.email})})}),e.jsx("div",{className:"group w-full",children:e.jsxs("div",{className:"content-body w-full p-3 bg-gray-900",children:[e.jsx("div",{className:"user-header h-10",children:e.jsx("div",{className:"user-details",children:e.jsx("h1",{className:"text-md",children:l.user_details.username})})}),e.jsx("div",{className:"content",children:e.jsx("p",{children:l.content})}),e.jsxs("div",{className:"likes flex justify-end items-center",children:[e.jsx(e.Fragment,{children:l.likes.includes(a==null?void 0:a._id)?e.jsx("div",{className:"like",onClick:()=>u(l._id),children:e.jsx(k,{size:15})}):e.jsx("div",{className:"likes",onClick:()=>j(l._id),children:e.jsx(w,{size:15})})}),l.likes.length]})]})})]},t):null)})})]})]},n)),e.jsxs("div",{className:"comment-box flex sticky bottom-0",children:[e.jsx("input",{type:"text",className:"bg-gray-700 w-full rounded-md",placeholder:"Add your comment",onChange:s=>f(s.target.value),value:h}),e.jsx("div",{className:"send-btn",onClick:N,children:e.jsx(C,{size:10})})]})]})]})})}function U({discussion:i,setDiscussion:p,type:o}){const{user:r}=D(l=>l.auth),x=P(),[a,h]=m.useState(!1),[f,y]=m.useState(!1),[c,j]=m.useState(null),[u,N]=m.useState(!1);async function _(){(await L(i._id)).likedDiscussion&&p(t=>t.map(d=>(d._id===i._id&&d.likes.push(r==null?void 0:r._id),d)))}m.useEffect(()=>{(async()=>{const l=await $(i.community_id);l.community&&j(l.community)})()},[i]);async function s(){(await M(i._id)).likedDiscussion&&p(t=>t.map(d=>(d._id===i._id&&(d.likes=d.likes.filter(R=>R!==(r==null?void 0:r._id))),d)))}async function n(){(await T(i._id)).deletedDiscussion&&p(t=>t.filter(d=>d._id!==i._id))}return e.jsxs("section",{className:"mb-5 bg-gray-900 w-full rounded-md p-2",children:[e.jsxs("header",{className:"header flex justify-between relative",children:[o==="RECENT"?e.jsxs("div",{className:"profile-img flex gap-3 items-start cursor-pointer",onClick:()=>x(`/community/view/${c==null?void 0:c._id}`),children:[c!=null&&c.icon?e.jsx("img",{src:c.icon,alt:"",className:"w-10 h-10 rounded-md"}):(c==null?void 0:c.community_name)&&e.jsxs("div",{className:"profile-icon",children:[e.jsx(z,{email:c==null?void 0:c.community_name,size:"small"})," "]}),e.jsxs("div",{className:"user-name",style:{lineHeight:".5"},children:[e.jsx("h1",{className:"text-lg",children:c==null?void 0:c.community_name}),e.jsxs("span",{className:"",style:{fontSize:"10px"},children:["Posted by @",i.userProfile.username]})]})]}):e.jsxs("div",{className:"profile-img flex gap-3",children:[i.userProfile.profile_img?e.jsx("img",{src:i.userProfile.profile_img,alt:"",className:"w-10 h-10 rounded-md"}):e.jsxs("div",{className:"profile-icon",children:[e.jsx(z,{email:i.userProfile.email,size:"small"})," "]}),e.jsx("div",{className:"user-name",children:e.jsx("h1",{className:"text-lg",children:i.userProfile.username})})]}),e.jsx("div",{className:"btn cursor-pointer",onClick:()=>y(!f),children:e.jsx(O,{size:25})}),f&&e.jsx("div",{className:"absolute right-0 top-5",children:e.jsx(g,{className:"w-48",children:i.user_id===(r==null?void 0:r._id)?e.jsx(g.Item,{onClick:n,children:"Delete"}):e.jsx(g.Item,{onClick:()=>N(!0),children:"Report"})})})]}),e.jsx("div",{className:"content py-5",children:i.content_type==="TEXT"?e.jsx("p",{children:i.content}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"my-3 text-slate-200",children:i.caption}),e.jsx("img",{src:i.content,alt:""})]})}),e.jsxs("div",{className:"footer flex items-center gap-4",children:[e.jsxs("div",{className:"like-section flex items-center text-sm",children:[i.likes.includes(r==null?void 0:r._id)?e.jsx("div",{className:"dislike-button",onClick:s,children:e.jsx(k,{size:25})}):e.jsx("div",{className:"like-button",onClick:_,children:e.jsx(w,{size:25})}),i.likes.length," likes"]}),e.jsxs("div",{className:"comment text-xl text-primary flex items-center gap-4 cursor-pointer",onClick:()=>h(!0),children:[e.jsx(V,{}),e.jsxs("div",{className:"text-sm text-white",children:[i.comments," comments"]})]})]}),e.jsx(F,{openModal:a,setOpenModal:h,discussion:i}),e.jsx(B,{openModal:u,setOpenModal:N,id:i._id,reported_type:"discussion"})]})}export{U as D};
