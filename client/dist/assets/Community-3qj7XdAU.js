import{u as f,m as v,a as g,r as i,i as D,Q as S,v as C,j as e,L as k,w as R,x as I,y as M,z as O,B as T,F as U,G as P}from"./index-smUx3BSe.js";import{d as Y}from"./Menu-cs__0NOm.js";import{M as N}from"./Toast-nm33oYh4.js";import{D as F}from"./DiscussionCard-IDNt8k-G.js";import"./index.esm-MxRIW45I.js";import"./Report-5wtcoAxQ.js";function $({showModal:t,setShowModal:a}){const{isLoading:c,isSuccess:l,isError:s,errorMessage:n}=f(x=>x.community),m=v(),o=g(),[d,u]=i.useState(""),[p,y]=i.useState([]),[r,w]=i.useState({community_name:"",topic:null,privacy:"public",about:""});i.useEffect(()=>{(async()=>{var x;try{const h=await D.get("/manage-account/interest");h.data&&y(h.data.interest)}catch(h){const b=h;S.error((x=b.response)==null?void 0:x.data.message)}})()},[]);function j(x){const{name:h,value:b}=x.target;w({...r,[h]:b})}i.useEffect(()=>{s&&S.error(n),l&&a(!1),(s||l)&&o(C())},[s,l,o,n,m,a]);function _(){r.community_name&&r.topic?(u(""),o(R(r))):r.community_name?r.topic||u("Please select a topic"):u("Please select a name")}return e.jsx(e.Fragment,{children:c?e.jsx(k,{}):e.jsxs(N,{show:t,size:"2xl",onClose:()=>{u(""),a(!1)},popup:!0,children:[e.jsx(N.Header,{children:e.jsx("div",{className:"p-4",children:"New Community"})}),e.jsxs(N.Body,{children:[d&&e.jsx("small",{className:"text-sm text-red-600",children:d}),e.jsxs("div",{className:"input-group flex flex-col",children:[e.jsx("label",{htmlFor:"",className:"font-medium",children:"Community Name"}),e.jsx("input",{type:"text",name:"community_name",id:"",className:"rounded-md",onChange:j})]}),e.jsxs("div",{className:"flex gap-3 w-full justify-between",children:[e.jsxs("div",{className:"input-group flex flex-col mt-5 w-full",children:[e.jsx("label",{htmlFor:"",className:"font-medium",children:"Choose a Topic"}),e.jsxs("select",{name:"topic",id:"",className:"rounded-md",onChange:j,children:[e.jsx("option",{value:""}),p.map((x,h)=>e.jsx("option",{value:x._id,children:x.interest},h))]})]}),e.jsxs("div",{className:"input-group flex flex-col mt-5 mb-5 w-full",children:[e.jsx("label",{htmlFor:"",className:"font-medium",children:"Privacy"}),e.jsxs("select",{name:"privacy",id:"",className:"rounded-md",onChange:j,children:[e.jsx("option",{value:"public",children:"Public"}),e.jsx("option",{value:"private",children:"Private"})]})]})]}),e.jsxs("div",{className:"input-group flex flex-col mt-5",children:[e.jsx("label",{htmlFor:"",className:"font-medium",children:"About"}),e.jsx("textarea",{name:"about",id:"",className:"rounded-md"})]}),e.jsxs("div",{className:"btn py-5",children:[e.jsx("button",{className:"btn px-5 py-1 bg-red-700 hover:bg-red-500 rounded-md text-white",onClick:()=>{w({community_name:"",topic:null,privacy:"public",about:""})},children:"Clear"}),e.jsx("button",{className:"btn px-5 py-1 bg-primary hover:bg-primary-hover ms-3 rounded-md text-white",onClick:_,children:"Create"})]})]})]})})}function E({community:t,type:a}){var u;const c=v(),l=g(),{user:s}=f(p=>p.auth),[n,m]=i.useState([]),[o,d]=i.useState([]);return i.useEffect(()=>{var p,y;m((p=t.members)==null?void 0:p.filter(r=>r.status==="active").map(r=>r.user_id)),d((y=t.members)==null?void 0:y.filter(r=>r.status==="pending").map(r=>r.user_id))},[t.members]),e.jsxs("div",{className:"community-card  rounded-md w-72 h-min bg-gray-900 shadow-lg",children:[e.jsx("div",{className:"icon  w-full h-min",children:t.icon?e.jsx("img",{src:t.icon,alt:"",className:"w-full h-28 object-cover"}):e.jsx("div",{className:"icon-with-text h-full flex items-center justify-center bg-gray-700",children:e.jsx("h1",{className:"text-6xl w-full h-28 rounded-full  text-center flex justify-center items-center",children:typeof(t==null?void 0:t.community_name)=="string"&&((u=t.community_name[0])==null?void 0:u.toUpperCase())})})}),e.jsxs("div",{className:"body bg-gray-900 py-3 px-2 h-44 flex flex-col justify-between",children:[e.jsx("h1",{className:"title text-wrap text-lg font-medium text-center",children:t.community_name}),e.jsx("div",{className:"stat",children:e.jsxs("h1",{className:"text-center",children:[n==null?void 0:n.length," Members"]})}),a==="my_community"||n.includes(s==null?void 0:s._id)?e.jsx("button",{className:"view-community w-full py-2 rounded-md bg-primary hover:bg-primary",onClick:()=>c(`/community/view/${t._id}`),children:"View"}):o.includes(s==null?void 0:s._id)?e.jsx("button",{className:"view-community w-full py-2 rounded-md bg-primary",children:"Pending"}):e.jsx("button",{className:"view-community w-full py-2 rounded-md bg-primary hover:bg-primary",onClick:()=>l(I(t._id)),children:"Join"})]})]})}function A(){const t=g(),{myCommunity:a,isSuccess:c,isError:l}=f(s=>s.community);return i.useEffect(()=>{t(M())},[t]),i.useEffect(()=>{t(C())},[c,l,t]),e.jsx("section",{className:"your-community flex p-5 flex-wrap gap-5 justify-evenly bg-gray-800 min-h-full",children:a.map((s,n)=>e.jsx(E,{community:s,type:"my_community"},n))})}function L(){const t=g(),{community:a,isSuccess:c,isError:l}=f(n=>n.community),{user:s}=f(n=>n.auth);return i.useEffect(()=>{t(O())},[t]),i.useEffect(()=>{t(C())},[c,l,t]),e.jsx("section",{className:"your-community flex sm:p-5 flex-wrap gap-5 justify-evenly bg-gray-800 min-h-full",children:a.map((n,m)=>{if(!n.members.filter(d=>d.status==="active").map(d=>d.user_id).includes(s==null?void 0:s._id))return e.jsx(E,{community:n,type:"discover"},m)})})}function V(){const[t,a]=i.useState([]),c=i.useRef(null);i.useEffect(()=>{l()},[]);async function l(){let s=null;s=t.length>0?t[t.length-1].createdAt:null;const n=await T(s);n.discussions&&a(s===null?n.discussions:[...t,...n.discussions])}return i.useEffect(()=>{const s=()=>{const{current:m}=c;if(m){const{scrollTop:o,scrollHeight:d,clientHeight:u}=m;o+u>=d-1&&l()}},n=c.current;return n&&n.addEventListener("scroll",s),()=>{n&&n.removeEventListener("scroll",s)}},[t]),e.jsx("div",{className:" p-5 sm:p-10 bg-gray-800 h-full overflow-y-scroll",ref:c,children:t.map((s,n)=>e.jsx(F,{discussion:s,setDiscussion:a,type:"RECENT"},n))})}function q(){const{tab:t}=U(),a=v(),[c,l]=i.useState("hidden"),[s,n]=i.useState(t.toUpperCase()),[m,o]=i.useState(!1);return e.jsxs("div",{className:"grid grid-cols-12",children:[e.jsx($,{showModal:m,setShowModal:o}),e.jsxs("div",{className:"flex gap-2 col-span-12",children:[e.jsx("button",{className:"p-2 sm:hidden  flex rounded-sm mb-3",onClick:()=>l(c==="block"?"hidden":"block"),children:e.jsx(Y,{})}),e.jsx("h1",{className:`${c==="block"?"hidden":"block"} sm:hidden text-xl mt-2`,children:"Community"})]}),e.jsxs("section",{className:`sidebar col-span-12 sm:col-span-3  bg-gray-900 flex flex-col p-5 py-8 ${c} sm:block`,children:[e.jsx("h1",{className:"text-2xl mb-10",children:"Community"}),e.jsxs("div",{className:"nav flex flex-col gap-3",onClick:()=>l(c==="block"?"hidden":"block"),children:[e.jsx("div",{className:`item hover:bg-gray-800 ${s==="RECENT_DISCUSSIONS"&&"bg-gray-800"}  rounded-md p-5 py-3`,onClick:()=>{n("RECENT_DISCUSSIONS"),a("/community/recent_discussions")},children:e.jsx("h2",{className:"text-lg",children:"Recent Discussions"})}),e.jsx("div",{className:`item hover:bg-gray-800 ${s==="DISCOVER"&&"bg-gray-800"}  rounded-md p-5 py-3`,onClick:()=>{n("DISCOVER"),a("/community/discover")},children:e.jsx("h2",{className:"text-lg",children:"Discover"})}),e.jsx("div",{className:`item hover:bg-gray-800 ${s==="YOUR_COMMUNITY"&&"bg-gray-800"}  rounded-md p-5 py-3`,onClick:()=>{n("YOUR_COMMUNITY"),a("/community/your_community")},children:e.jsx("h2",{className:"text-lg",children:"Your Community"})})]}),e.jsx("div",{className:"new-community mt-7 px-5 py-3 bg-gray-800 hover:bg-gray-600 cursor-pointer rounded-md",children:e.jsxs("button",{className:"text-lg flex gap-3",onClick:()=>o(!0),children:[e.jsx("div",{className:"text-primary",children:e.jsx(P,{})}),"Community"]})})]}),e.jsx("section",{className:"page-body col-span-12 sm:col-span-9 bg-blue-700",children:s==="RECENT_DISCUSSIONS"?e.jsx(V,{}):s==="DISCOVER"?e.jsx(L,{}):s==="YOUR_COMMUNITY"?e.jsx(A,{}):null})]})}export{q as default};
